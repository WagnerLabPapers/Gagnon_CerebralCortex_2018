function [daq, status, time0] = StartShock(pulseLength)%% based on StartScan() function, kjh 1/25/11%% StartShock - Ssend a pulse to the SD-9 stimulator that can trigger a% shock stimulus%%  [status, time0] = StartShock(pulseLength);%             when error ocurred status will be non-zero%             time0 is the time (GetSecs) when the onset of the pulse%             started, used for syncing stimulus and MR time.%% Uses USB-1208FS and Psychtoolbox. Pin 14 will give ~5V signal, pin 17% can be used as a ground.%%% defaultsif nargin < 1 | isempty(pulseLength),    pulseLength=0.001;end;status = 0; % unless we have problems% Do we have a USB-1208FS daq?daq=DaqDeviceIndex;if length(daq) == 0, % No we don't    disp(sprintf(['[' mfilename ']:Sorry. Couldn''t find a USB-1208FS box connected to your computer.\n' ...            'NOT RESPONDING? If PsychHID is not responding, e.g. after unplugging and\n' ...           're-plugging the USB connector of your device, try quitting and restarting\n' ...           'MATLAB. We find that this reliably restores normal communication.']));    disp(sprintf(['[' mfilename ']:SHOCK DEVICE NOT STARTED!']));    status = 1;    time0  = GetSecs;    return;else, % Yes we do    devices=PsychHID('Devices');    d=devices(daq(1)); % use only first one if more connected    disp(sprintf('[%s]:Found USB-1208FS daq: device %d, serialNumber %s.',...            mfilename,d.index,d.serialNumber));end;% Configuring digital ports for outputerr=DaqDConfigPort(daq(1),1,0); % should be pin 14% Make sure the USB-1208FS is "attached". If not give a warning message.% We may want to consider giving an error... if streq(err.name,'kIOReturnNotAttached')    disp(sprintf(['[' mfilename ']:Mac OS error message says USB-1208FS is "not attached".\n'...          'If it is attached, we suggest that you quit and restart MATLAB.']));    disp(sprintf(['[' mfilename ']:SHOCK DEVICE NOT STARTED!']));    status = 1;    time0  = GetSecs;    return;end% get time0time0 = GetSecs;% Send pulseDaqAOut(daq(1),1,1);    % send pulseWaitSecs(pulseLength);  % for a particular length, and thenDaqAOut(daq(1),1,0);    % resetreturn;